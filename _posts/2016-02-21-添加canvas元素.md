---
layout: post
title: html5绘制图形
categories: [语言学习]
tags: [html, canvas]
---
#### 添加canvas元素

```
<canvas id="myCanvas" width="300" height="200" style="border: 1px solid #c3c3c3;">
Your Browser does not support the canvas element.
</canvas>
//js中
var c = document.getElementById("myCanvas");
var cxt = c.getContext("2d");
cxt.fillStyle = "#FF0000"; //将其染成红色
cxt.fillRect(0, 0, 150, 75); //绘制长方形,没有边框，只有填充色，起始x,y, w, h;
cxt.strokeRect(0, 0, 150, 75）; 只有边框
cxt.clearRect(0， 0， 150， 75); 清除一个长方形区域，该区域没有任何线条
```

### 绘制基本形状
#### 绘制图形
|函数|功能|
|-----|------|
|beginPath()|开始绘制路径|
|arc(x, y, radius, startAngle, endAngle, anticlockwise)|x,y是圆心，radius是半径，弧度，anticlockwise是定义画圆的方向，true or false|
|closePath()|结束路径的绘制|
|fill()|进行填充，先用cxt,fillStyle=color设置颜色|
|stroke()|方法设置边框|
|moveTo(x, y)|不绘制，只是将当前位置移动到新的目标坐标x,y，并作为线条开始点|
|lineTo(x, y)|绘制线条到指定目标x,y,并且在两个坐标之间画一条线，不过只有调用了stroke(绘制)或者fill(填充)，才会真正绘制，这里只是定义路径的位置|
|lineWidth|属性，定义线条的粗细，cxt.lineWidth = 14|

#### 使用bezierCurveTo绘制贝塞尔曲线
bezierCurveTo(cpX1, cpY1, cpX2, cpY2, x, y);
为一个画布的当前子路径添加一条三次贝塞尔曲线。开始点是画布当前点，结束点是x,y,两个cp分别为控制点。方法结束时，当前的位置为x,y

#### 绘制线性渐变

```
var gradient = cxt.createLinearGradient(0, 0, 0, canvas.height); //创建渐变对象，沿着直线从（0，0）到（0， canvas.height）绘制渐变.
gradient.addColorStop(0, "#fff"); //颜色值和偏移量，偏移量是从0到1.0的数值，代表沿着渐变线渐变的距离有多远.
gradient.addColorStop(1, "#000");
cxt.fillStyle = gradient; //设置填充的渐变
cxt.fillRect(0, 0, 400, 400);
```

#### 绘制径向渐变

```
var gradient = cxt.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, 150);//六个参数，分别是开始圆的圆心半径，结束圆的圆心半径
gradient.addColorStop(0, '#fff'）;
gradient.addColorStop(1, "#000");
cxt.fillStyle = gradient;
cxt.fillRect(0, 0, 400, 400);
```

#### 绘制变形图形

```
cxt.translate(200, 50); //将绘图区相对于当前画布的左上角进行平移。以原来的原点为参考，然后以偏移后的位置作为坐标原点。
```
#### 图形缩放
```
cxt.scale(x, y); //在x方向和y方向分别缩放多少. 每调用一次，canvas的原来的比例就被缩放一次
```
**位置和尺寸都被缩放了**
#### 旋转图形
```
cxt.rotate(Math.PI/10); //从左上角旋转一定的弧度，每调用一次，就旋转一次。
```
#### 图形组合
可以将图形画到另一个图形之上，但受制于图形绘制顺序。可以利用globalCompositeOperation属性来改变这些做法。不仅可以在已有的图形后面在画新图，还可以用来遮盖，清除（比clearRect函数方便）
globalCompositeOperation = type;

```
globalCompositeOperation = 'source-in';
```

|属性值|说明|
|-----|-----|
|source-over|默认，新图形会覆盖原有的内容|
|destination-over|会在原有内容之下绘制新图形|
|source-in|新图形会仅仅出现与原有内容重叠的部分，其他区域透明|
|destination-in|原有内容中与新图形重叠的部分会被保留，其他区域都变成透明的|
|source-out|新图形与原有内容不重叠的部分会被绘制出来|
|destination-out|原有内容中与新图形不重叠的部分会被保留|
|source-atop|新图形中与原有内容重叠的部分会被绘制，并覆盖在原有内容之上|
|destination-atop|原有内容中与新内容重叠的部分会被保留，并会在原有内容之下绘制新图形|
|lighter|两图形重叠部分做加色处理|
|darker|两图形中重叠部分做减色处理|
|xor|重叠部分会变成透明|
|copy|只有新图形会被保留，其他都被清除掉|

#### 绘制阴影
```
cxt.shadowOffsetX = 15; //水平阴影15px
cxt.shadowOffsetY = 15; //y方向阴影
cxt.shadowBlur = 10; //设置阴影模糊程度，此值越大，阴影越模糊。其效果和PhotoShop高斯模糊滤镜相同。
cxt.shadowColor = "#f00";
```

#### 绘制图像
```
var image = new Image();
img.src = "01.jpg";
img.onload = function() {
	ctx.drawImage(img, 0, 0);
};
```
|函数|说明|
|-----|-----|
|drawImage(image, x,y)|接收一个图片，并插入到canvas中，xy代表左上角|
|drawImage(image, dx, dy, dw, dh)|把图片缩放到dw和dh的尺寸，然后画到dx,dy的位置|
|drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh)|通过s四个参数，指定图片裁剪范围，然后缩放到dw, dh,显示到dx, dy的位置|

#### 图像平铺
使用createPattern替换之前的drawImage
createPattern(image, type);

|参数值|说明|
|------|------|
|no-repeat|不平铺|
|repeat-x|横方向平铺|
|repeat-y|纵方向平铺|
|repeat|全方向平铺|

```
image.onload = function(){
	var p = cxt.createPattern(image, 'repeat'）;
	cxt.fillStyle = p;
	cxt.fillRect(0, 0, 400, 300);
}
```
#### 图像裁剪
clip函数表示给canvas设置一个剪辑区域，在clip函数之后的代码，只对这个设定的剪辑区域有效，不会影响其他地方，在局域更新时很有用。默认情况下，剪辑区域是一个左上角在(0,0),宽和高分别等于canvas元素的宽和高的一个矩形
一般先用beginPath（）。。。lineTo等设置路径。

#### 像素处理
canvas中用ImageData来保存图像的像素值，有width, height, data三个属性。data是一个连续数组，所有的像素值都在data里面。

|函数|说明|
|------|-------|
|createImageData(width, height)|在内存创建一个制定大小的ImageData对象，每个像素点都是黑色透明的 ，rgba(0,0,0,0)|
|getImageData(x, y, width, height)|返回一个ImageData,包含指定区域的像素数组|
|putImageData(data, x, y)|将ImageData对象绘制到屏幕指定区域上|

#### 绘制文字
|函数|说明|
|------|------|
|fillText(text, x, y, maxWidth)|绘制带有fillStyle填充的文字，文本参数以及用于指定文本位置的坐标参数，MaxWidth是可选参数，用于限制字体大小，它会将文本字体强制收缩到指定尺寸|
|trokeText(text, x, y, maxWidth)|绘制只有strokeStyle边框的文字，其参数含义与上面相同，只有文字边框，文字没填充|
|measureText|返回一个度量对象，包含在当前context环境下指定文本的实际显示宽度|

#### 保存和恢复状态
save把当前状态压入栈中，restore从栈顶弹出状态。restore和save要配对使用，restore调用次数不能多于save，否则发生Error。

#### 保存文件
var w = cxt.canvas.toDataURL('image/png')
返回一个以data开始，data:image/png;base64, XXX...的数据，一般浏览器支持base64