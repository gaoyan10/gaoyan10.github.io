---
layout: post
title: 利用Hosthatch购买VPS搭建VPN
categories: [沧海遗珠]
tags: [Hosthatch, vps, vpn, shadowshocks]
---

今天发现以前使用的vpn（以前朋友利用vps搭建的vpn）基本处于不可用状态了，但自己每天都需要翻墙去Google, Stackoverflow等网站求助编程问题，所以自己购买了一个vps来搭建vpn服务器。

#### 服务器配置、节点选择

进入SSD VPS购买，8美金一个季度的就足够了，流量1T,30GSSD的存储空间和256M的内存。

![VPS](http://img.blog.csdn.net/20160506181534614)

很多论坛表示购买香港的节点比国外的要快一些，但我这边购买了一个阿姆斯特丹的，一个香港的vps，不管是ping的响应时间、terminal里的流畅度还是真正翻墙时的上网速度，都感觉阿姆斯特丹的更快一些。服务器我选择了centos6 64位。

hosthatch官方购买邀请链接[https://portal.hosthatch.com/aff.php?aff=643](https://portal.hosthatch.com/aff.php?aff=643)

使用信用卡支付，购买成功后，在client portal里会发现vps是pending状态，再等大概十分钟，会收到邮件，提示vps进入可用状态，并且会把VPS panel的username和password发过来。

#### 开启PPP

用root账号ssh登录后，运行

```
cat /dev/ppp

```
如果发现提示没有权限进行相关操作，应该就是vps的ppp模块没有开启，登录VPS panel，选择VPS管理，在底部会发现

![PPP](http://img.blog.csdn.net/20160506183754922)

原来是Off，把TUN/TAP和PPP依次选择为ON。每次切换服务器都会重启一次。

#### Shadowsocks配置

Shadowsocks是最简单的一种配置方式。这里[秋水逸冰的博客](https://teddysun.com/342.html)，里面介绍的特别详细，这里把主要步骤描述一下，作为留存。

root用户登录，运行以下命令：


```
wget --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh
chmod +x shadowsocks.sh
./shadowsocks.sh 2>&1 | tee shadowsocks.log

```

注意运行前，export LC_ALL=C，防止出现locale错误。

安装完成后，会有以下提示

```
Congratulations, shadowsocks install completed!
Your Server IP:your_server_ip
Your Server Port:your_server_port
Your Password:your_password
Your Local IP:127.0.0.1
Your Local Port:1080
Your Encryption Method:aes-256-cfb

Welcome to visit:https://teddysun.com/342.html
Enjoy it!
```

可以修改/etc/shadowsocks.json里的配置文件。

单用户配置如下：

```
{
    "server":"0.0.0.0",
    "server_port":8989,
    "local_address":"127.0.0.1",
    "local_port":1080,
    "password":"yourpassword",
    "timeout":300,
    "method":"aes-256-cfb",
    "fast_open": false
}

```

多用户多端口配置如下：

```
{
    "server":"0.0.0.0",
    "local_address":"127.0.0.1",
    "local_port":1080,
    "port_password":{
         "8989":"password0",
         "9001":"password1",
         "9002":"password2",
         "9003":"password3",
         "9004":"password4"
    },
    "timeout":300,
    "method":"aes-256-cfb",
    "fast_open": false
}
```

修改了配置文件后需要重启shadowsocks，shadowsocks主要命令如下：

```
启动：/etc/init.d/shadowsocks start
停止：/etc/init.d/shadowsocks stop
重启：/etc/init.d/shadowsocks restart
状态：/etc/init.d/shadowsocks status

```

shadowsocks客户端下载地址如下：

[下载地址一，sourceforge，需要翻墙](https://sourceforge.net/projects/shadowsocksgui/files/dist/)

[下载地址二，https://shadowsocks.com/client.html](https://shadowsocks.com/client.html)

另外可以在chrome上安装Proxy SwitchyOmega，来达到自动切换代理模式，国内站点不走代理的目的。


##### 其他方式的VPN，PPTP协议方式的搭建过程

这种方式我没有尝试，步骤稍微多一些，具体可以参考这篇博文
[2016年教你怎样翻墙，利用VPS搭建VPN教程[更新SS（影梭）安装教程]](http://www.cwctv.com/archives/15150.html)